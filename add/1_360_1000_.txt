<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="koi8-r">
  <title>Электронная очередь</title>
  <link rel="SHORTCUT ICON" href="./content/00/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="http://@D3000800000/ochered/styleo.css" rel="stylesheet" type="text/css">
</head>
<body>
  <div class="wrapper">
	<header class="header">
	  <div class="header__logo">
		<span>@D3999200000</span>
	  </div>
	  <div class="header__time">
		<span id="time"></span>
	  </div>
	</header>
	<main class="main">
	  <div class="list main__list">
		<button type="button" class="list__item" onclick="ochered_v01(1);">Регистратура</button>
		<button type="button" class="list__item" onclick="ochered_v01(2);">Процедурный<BR>кабинет</button>
		<button type="button" class="list__item" id="doctor" onclick="loc_1_7_55_5(5, 530, 10)">
		<!-- <button type="button" class="list__item" id="doctor" onclick="jsa_031('f_10_02_2_1', 5, 645, 602)"> -->
		  <span class="button__text">Запись в кабинет</span>
		  <span class="button__msg"></span>
		</button>
		<button type="button" class="list__item" id="zapis" onclick="loc_1_7_55_5(5, 530, 20)">
		  <span class="button__text">Запись к врачу</span>
		  <span class="button__msg"></span>
		</button>
	  </div>
	</main>	
	<footer class="footer">
	  <span>ООО Апекс-Реал</span>
	</footer>
	<input type="hidden" name="bip_" value="@D3000810000">
	<input type="hidden" name="org_name" value="@D3000820000">
	<!-- <form></form> -->
	<!-- <form accept-charset="koi8-r" method="post" id="f_10_02_2_1" name="f_10_02_2_1" action="http://zeromis.tutmed.by/cgi-bin/is10_08" target="is10_08"> -->
	  <!-- <form accept-charset="koi8-r" method="post" id="f_10_02_2_1" name="f_10_02_2_1" action="https://zeromis.tutmed.by/cgi-bin/is10_08" target="is10_08" hidden> -->
	 <!-- <form accept-charset="koi8-r" method="post" id="f_10_02_2_1" name="f_10_02_2_1" action="https://zeromis0.tutmed.by/cgi-bin/is10_08" target="is10_08"> -->
  <!-- <form class="block-request" method="post" id="f_10_02_2_1" name="f_10_02_2_1" action="https://0.tutmed.by/cgi-bin/is10_08" target="is10_08" hidden> -->
	<!-- <form accept-charset="koi8-r" class="block-request" method="post" id="f_10_02_2_1" name="f_10_02_2_1" action="https://zeromis0.tutmed.by/cgi-bin/is10_08" target="is10_08" hidden> -->
<!--	  <input type="hidden" name="sSd_" value="0">
	  <input type="hidden" name="svid_" value="0">
	  <input type="hidden" name="sgr_l" value="0">
	  <input type="hidden" name="sit_l" id="x0001" value="0">
	  <input type="hidden" name="stst_" value="0">
	  <input type="hidden" name="cod_e" value="0">
	  <input type="hidden" name="stat_e" value="0">
	  <input type="hidden" name="sfil_n" value="19">
	  <input type="hidden" name="sfrname_" value="is10_08">
	  <input type="hidden" name="sadd_" id="x0005" value="">
	  <input type="hidden" name="nAgain_" id="x0006" value="2">
	  <input type="hidden" name="sAdres_start" id="sAdres_start"  value="">
	  <input type="hidden" name="s_print" value="MITSU_RP-809">
	  <input type="hidden" name="RaspToKab" value="1">
	</form> -->
  </div>
  <script>
	//document.getElementById("sAdres_start").value=document.location.href;
	
	window.name="is10_08";
	console.log(document.f_10_02_2_1);

	function getXmlHttp() {
	  var xmlhttp;
	  try {
		xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
	  } catch(e) {
		try {
		  xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		} catch(E) {
		  xmlhttp = false;
		}
	  }
	  if (!xmlhttp && typeof XMLHttpRequest != 'undefined') {
		xmlhttp = new XMLHttpRequest();
	  }
	  return xmlhttp;
	};

	function jsa_032(nType, sUrl_, sBody_, sConttype) {
	  var sResults_ = '';
	  var xmlhttp = getXmlHttp();
	  xmlhttp.open(nType, sUrl_, false);
	  xmlhttp.send(sBody_);

	  if (xmlhttp.status == 200) {
		sResults_= xmlhttp.responseText;
	  } else {
		sResults_=xmlhttp.status;
	  }
	  return sResults_;
	};

	function requestDB(url) {
		fetch(url)
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP ошибка! Статус: ${response.status}`);
				}
				return response.json();
			})
			.then(data => {
				//console.log(data);
				showTicket(data['stdout']);
			})
			.catch(error => {
				console.error('Ошибка:', error);
			});
	};
	
	function showTicket(data) {
		window.location.replace('http://@D3000800000/cgi-bin/is10_08?sSd_=0&svid_=1&sgr_l=360&sit_l=1010&sfil_n=@D3999226010&ticket_ps='+data[0]+'&ticket_html='+data[1]+'&link_reverse=@D3000720000');
	};

	function ochered_v01(nI_){
		requestDB('http://@D3000800000/cgi-bin/is10_09?sSd_=0&svid_=1&sgr_l=360&stst_=0&sit_l=200&shead_=0&sgr_r=0&sfil_n=@D3999226010&style_=1&queue_n='+nI_);
	};


	function jsa_031(name, nVid_, nGr_l, nNum_, sTarget_, sAddn_, sAction_) {
	  const form = document[name];
	  const temp = Object.assign(form);
	  temp.svid_.value = nVid_;
	  temp.sgr_l.value = nGr_l;
	  temp.sit_l.value = nNum_;
	  if ( sTarget_ !== undefined && sTarget_ !== '') {
		temp.target = sTarget_;
		temp.sfrname_.value = sTarget_;
	  };
	  if (sAction_ !== undefined && sAction_ !== '') {
		temp.action = sAction_;
	  };
	  if (sAddn_ !== undefined && sAddn_ !== '') {
		temp.sadd_.value = sAddn_;
	  }
	  temp.submit();
	}
	
	function loc_1_7_55_5(svid_,sgr_l,sit_l) {		
	  //var action = document.f_10_02_2_1.action;
	  //var n_svid_ = document.f_10_02_2_1.svid_.value;
	  //var n_sgr_l = document.f_10_02_2_1.sgr_l.value;
	  //var n_sit_l = document.f_10_02_2_1.sit_l.value;
	  //var sTmp_2 = window.location.origin; //определяем host
	  document.f_10_02_2_1.method = 'GET';
	  //console.log(document.f_10_02_2_1);
	  
	  document.f_10_02_2_1.action = "@D3000830000/cgi-bin/is10_08?sabc_=0_1_360_1000";
	  document.f_10_02_2_1.svid_.value = svid_;
	  document.f_10_02_2_1.sgr_l.value = sgr_l;
	  document.f_10_02_2_1.sit_l.value = sit_l;
	  document.f_10_02_2_1.sfil_n.value = 2092; //7 поликлиника 2092;
	  document.f_10_02_2_1.submit();
	  
	  //document.f_10_02_2_1.action = action;
	  //document.f_10_02_2_1.svid_.value = n_svid_;
	  //document.f_10_02_2_1.sgr_l.value = n_sgr_l;
	  //document.f_10_02_2_1.sit_l.value = n_sit_l;
	  
	  // console.log(parent.upSubFrame.document.f_10_02_1_rgt.action);
	}

	function getTimeByFormat(hour, minute) {
	  const text = String(hour).padStart(2, '0') + ':' + String(minute).padStart(2, '0');
	  return text;
	}

	const divTime = document.getElementById("time");
	
	function updateClock(text) {
	  divTime.innerText = text;
	}

	const hourOpen = 0;
	const minutOpen = 1;
	const buttonDoctor = document.getElementById("doctor");
	const buttonDoctorText = document.querySelector("#doctor > span.button__text");
	const buttonDoctorMsg = document.querySelector("#doctor > span.button__msg");
	buttonDoctorMsg.textContent = 'откроется с ' +  getTimeByFormat(hourOpen, minutOpen);

	function updateButtonDoctor(text, hour, minute) {
	  if (hour > hourOpen || (hour == hourOpen && minute >= minutOpen)) {
		buttonDoctor.style.background = '#035720';
		buttonDoctor.style.pointerEvents = "auto";
		buttonDoctorText.style.fontWeight = 'bold';
		buttonDoctorMsg.classList.add('msg-hidden');
	  } else {
		buttonDoctor.style.background = 'gray';
		buttonDoctor.style.pointerEvents = "none";
		buttonDoctorText.style.fontWeight = 'normal';
		buttonDoctorMsg.classList.remove('msg-hidden');
	  }
	}

	function updateTime() {
	  const date = new Date();
	  const hour = date.getHours();
	  const minute = date.getMinutes();
	  const timeString = getTimeByFormat(hour, minute);
	  updateClock(timeString);
	  updateButtonDoctor(timeString, hour, minute);
	}
	updateTime();
	setInterval(updateTime, 3000);
  </script>
</body>
</html>
###

#PROGRAM:
LOCAL nDb_ := {0}, aTmp := {}, sTmp, nTmp, nI_1, nLen_1,aTmp_ := {}

*? '1,360,1010 =', a003_,aPar_

* 1 

DO WHILE .T.
    a999_[22] = 19

	aTmp_ := AT2_210_3(a998_[53],' ')
	a000_[80] := aTmp_[01]
	a000_[81] := CT3_027_(1,aTmp_[01])
	
    a000_[82] := CT3_027_(1,a999_[20])
    
    aTmp_ := {}
    aTmp_ := AT2_210_3(a998_[54],' ')
    a000_[83] := aTmp_[01]
	
	sTxt1_ = "http://" + a000_[80] + "/cgi-bin/is10_08?svid_=1&sSd_=0&sgr_l=360&sit_l=1000&sfil_n=" + ZSTR(a999_[22])
	a000_[72] = CT3_027_(1, sTxt1_)
//	sfil := CT6_209_(aPar_,"sfil_n")
/*	
* выборка журнала за месяц
	cSql = "SELECT T131__01 FROM T231_"+sfil+" WHERE T131__08=12012090 AND T131__97="+sfil+" AND T131__98=0"
*? '<br>1=',cSql
	IF .NOT. CheckResult(CT12_209_(hPipe,cSql,aTmp_))
		sRet_ = 'Int.err 7 1'
		EXIT
	ENDIF
*? aTmp_
	IF LEN(aTmp_) = 0
		sRet_ = 'Int.err 1 '+cSql
		EXIT
	ENDIF
	setting_id := aTmp_[01]
*/	  
? AT0_001_(XP:PART[01])
//? "console.log('",setting_id,"');"

	EXIT
ENDDO
*? '<script language="JavaScript" type="text/JavaScript">'
*? "console.log('",setting_id,"');"
*IF sRet_ = "0"
*? "console.log('Запись на прием выполнена');"
*ELSE
*? "console.log('",sRet_,"');"
*ENDIF
*? '</script>'
		
	